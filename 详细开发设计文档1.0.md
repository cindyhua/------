## 功能模块分解

### 1. 图像识别与数据提取模块

#### 1.1 相机管理模块
- **输入**：用户交互（拍照按钮、相册选择按钮）
- **输出**：图像数据（UIImage）
- **功能点**：
  - 相机拍摄控制
  - 相册图片选择
  - 实时预览
  - 手动区域选择

#### 1.2 OCR识别模块
- **输入**：图像数据（UIImage）
- **输出**：识别文本（String）、文本区域（CGRect[]）
- **功能点**：
  - 营养成分表区域自动检测
  - 文字识别处理
  - 图像预处理优化
  - 多语言识别支持
  - **多模态大模型集成**
    - 阿里通义千文或其他平台的多模态大模型API集成
    - 专业OCR与大模型结果融合
    - 失败降级处理机制

#### 1.3 数据解析模块
- **输入**：识别文本（String）
- **输出**：结构化营养数据（NutritionData对象）
- **功能点**：
  - 营养成分数据提取
  - 配料表文本解析
  - 数据格式化和标准化
  - 识别结果验证
  - **大模型辅助解析**
    - 使用大模型进行非标准格式解析
    - 模糊数据智能推断
    - 配料成分深度分析

### 2. 食品记录管理模块

#### 2.1 食品封面管理
- **输入**：图像数据（UIImage）、食品信息
- **输出**：食品记录（FoodRecord对象）
- **功能点**：
  - 食品封面拍摄
  - 图片编辑和处理
  - 食品数据关联
  - 图片保存和管理

#### 2.2 记录存储模块
- **输入**：食品记录（FoodRecord对象）
- **输出**：存储状态（布尔值）
- **功能点**：
  - Core Data数据存储
  - 历史记录管理
  - 记录标签和分类
  - 数据查询和检索

### 3. 营养分析模块

#### 3.1 营养标准对比
- **输入**：营养数据（NutritionData对象）、用户数据（User对象）
- **输出**：营养分析结果（NutritionAnalysis对象）
- **功能点**：
  - DRIs标准数据库
  - 个人化推荐计算
  - 营养素占比分析
  - 营养平衡评估
  - **大模型营养分析**
    - 调用大模型生成个性化营养建议
    - 基于用户健康目标的定制化分析
    - 相关学术研究和营养知识引用

#### 3.2 营养评分系统
- **输入**：营养数据（NutritionData对象）
- **输出**：评分结果（NutritionScore对象）
- **功能点**：
  - 多维度评分算法
  - 评分可视化展示
  - 健康提示生成
  - 评分历史对比
  - **大模型辅助评分**
    - 结合大模型分析特殊食品类别
    - 生成针对性健康建议
    - 考虑用户特定健康状况的智能评估

### 4. 食品PK对比模块

#### 4.1 对比引擎
- **输入**：两个食品记录（FoodRecord对象）、对比维度设置
- **输出**：对比结果（ComparisonResult对象）
- **功能点**：
  - 多维度数据对比
  - 营养差异计算
  - 综合评分生成
  - 推荐结果算法

#### 4.2 对比维度配置
- **输入**：用户选择、预设模板
- **输出**：对比配置（ComparisonConfig对象）
- **功能点**：
  - 预设模板管理
  - 自定义维度设置
  - 用户偏好保存
  - 维度权重调整

### 5. 分享图片生成模块

#### 5.1 模板管理
- **输入**：模板类别、用户选择
- **输出**：选定模板（ShareTemplate对象）
- **功能点**：
  - 模板列表加载
  - 模板预览生成
  - 模板分类管理
  - 模板更新下载

#### 5.2 图片渲染引擎
- **输入**：食品数据、模板、自定义设置
- **输出**：渲染图片（UIImage）
- **功能点**：
  - 动态布局计算
  - 图片合成渲染
  - 文本排版
  - 特效处理

#### 5.3 分享服务
- **输入**：渲染图片（UIImage）、分享目标
- **输出**：分享结果（布尔值）
- **功能点**：
  - 系统分享功能集成
  - 社交平台接口
  - 图片保存到相册
  - 分享状态追踪

### 6. 用户配置模块

#### 6.1 用户信息管理
- **输入**：用户信息表单数据
- **输出**：用户配置（User对象）
- **功能点**：
  - 个人档案创建
  - 健康数据管理
  - 饮食偏好设置
  - 数据验证和保存

#### 6.2 营养目标配置
- **输入**：用户信息、健康目标
- **输出**：营养目标（NutritionGoal对象）
- **功能点**：
  - 推荐值自动计算
  - 自定义目标设置
  - 警戒阈值配置
  - 目标进度追踪

### 7. 数据同步模块

#### 7.1 本地数据管理
- **输入**：各类应用数据
- **输出**：持久化状态
- **功能点**：
  - Core Data操作封装
  - 数据模型管理
  - 版本迁移支持
  - 数据完整性校验

#### 7.2 网络同步服务
- **输入**：本地变更数据、同步配置
- **输出**：同步结果（SyncResult对象）
- **功能点**：
  - 增量数据同步
  - 冲突解决策略
  - 网络状态管理
  - 后台同步调度

## 类图和时序图

### 主要类结构

#### 数据模型类

```
User
├── userId: String
├── name: String
├── gender: Gender
├── birthDate: Date
├── height: Double
├── weight: Double
├── activityLevel: ActivityLevel
├── dietaryPreferences: [String]
├── healthGoal: HealthGoal
├── createdAt: Date
├── updatedAt: Date
├── nutritionGoals: NutritionGoal
└── scanHistory: [FoodRecord]

NutritionGoal
├── goalId: String
├── caloriesGoal: Double
├── proteinGoal: Double
├── fatGoal: Double
├── carbsGoal: Double
├── sugarLimit: Double
├── sodiumLimit: Double
├── fiberGoal: Double
├── isCustomized: Bool
├── createdAt: Date
├── updatedAt: Date
└── user: User

Food
├── foodId: String
├── name: String
├── brand: String
├── category: String
├── barcode: String?
├── imageUrl: String
├── nutritionScore: NutritionScoreGrade
├── isUserCreated: Bool
├── createdAt: Date
├── updatedAt: Date
├── nutritionData: NutritionData
├── ingredients: Ingredients
└── records: [FoodRecord]

NutritionData
├── nutritionId: String
├── calories: Double
├── protein: Double
├── fat: Double
├── saturatedFat: Double
├── transFat: Double
├── carbohydrates: Double
├── sugar: Double
├── fiber: Double
├── sodium: Double
├── calcium: Double
├── servingSize: Double
├── servingUnit: String
├── servingsPerContainer: Double
├── lastVerified: Date
└── food: Food

Ingredients
├── ingredientsId: String
├── rawText: String
├── parsedIngredients: [String]
├── containsAllergens: [String]
└── food: Food

FoodRecord
├── recordId: String
├── scanDate: Date
├── location: String?
├── userNotes: String
├── consumptionAmount: Double
├── favorite: Bool
├── tags: [String]
├── food: Food
├── user: User
└── comparisons: [Comparison]

Comparison
├── comparisonId: String
├── comparisonDate: Date
├── comparisonType: ComparisonType
├── customDimensions: [String]
├── resultSummary: String
├── shared: Bool
├── firstFood: FoodRecord
└── secondFood: FoodRecord

ShareTemplate
├── templateId: String
├── name: String
├── category: String
├── previewImageUrl: String
├── templateData: Data
├── isDownloaded: Bool
├── isFavorite: Bool
├── seasonality: Season
└── lastUpdated: Date
```

#### 服务类

```
CameraService
├── setupSession()
├── startCapture()
├── stopCapture()
├── capturePhoto()
├── toggleFlash()
└── switchCamera()

OcrService
├── recognizeText(image: UIImage) -> RecognitionResult
├── detectNutritionTable(image: UIImage) -> CGRect?
├── detectIngredientsList(image: UIImage) -> CGRect?
├── enhanceImage(image: UIImage) -> UIImage
├── submitFeedback(result: RecognitionResult, correction: String)
├── recognizeWithMultiModalModel(image: UIImage) -> RecognitionResult
└── fallbackToLocalOcr(image: UIImage) -> RecognitionResult

NutritionParser
├── parseNutritionData(text: String) -> NutritionData
├── parseIngredients(text: String) -> Ingredients
├── normalizeUnits(value: Double, unit: String) -> Double
├── validateData(nutritionData: NutritionData) -> ValidationResult
├── inferMissingValues(partialData: NutritionData) -> NutritionData
├── parseWithMultiModalModel(image: UIImage, text: String) -> NutritionData
└── extractAllergensWithModel(ingredients: String) -> [String]

FoodRepository
├── saveFood(food: Food) -> Bool
├── getFoodById(id: String) -> Food?
├── searchFoods(query: String) -> [Food]
├── filterFoods(criteria: FilterCriteria) -> [Food]
├── getFavorites() -> [Food]
└── syncWithServer() -> SyncResult

NutritionAnalyzer
├── calculateScore(nutritionData: NutritionData) -> NutritionScore
├── compareWithDRIs(nutritionData: NutritionData, user: User) -> NutritionAnalysis
├── generateRecommendations(analysis: NutritionAnalysis) -> [Recommendation]
├── compareNutrition(data1: NutritionData, data2: NutritionData) -> ComparisonResult
├── generateAdviceWithLLM(nutritionData: NutritionData, user: User) -> HealthAdvice
└── customizeAdviceForHealthGoal(advice: HealthAdvice, goal: HealthGoal) -> HealthAdvice

ComparisonEngine
├── compare(first: Food, second: Food, config: ComparisonConfig) -> ComparisonResult
├── calculateDifferences(first: NutritionData, second: NutritionData) -> [NutritionDifference]
├── normalizeByServing(nutritionData: NutritionData, amount: Double) -> NutritionData
└── generateRecommendation(result: ComparisonResult, goal: HealthGoal) -> String

ShareImageGenerator
├── loadTemplates() -> [ShareTemplate]
├── previewTemplate(template: ShareTemplate, food: Food) -> UIImage
├── generateImage(template: ShareTemplate, data: ImageGenerationData) -> UIImage
├── saveToGallery(image: UIImage) -> Bool
└── shareToSocialMedia(image: UIImage, platform: SocialPlatform) -> Bool

UserService
├── createUser(userData: UserData) -> User
├── updateUser(user: User) -> Bool
├── calculateNutritionGoals(user: User) -> NutritionGoal
├── getUserSettings() -> UserSettings
└── syncUserData() -> SyncResult

DataSyncManager
├── checkForUpdates() -> UpdateStatus
├── syncFoodDatabase() -> SyncResult
├── uploadLocalChanges() -> SyncResult
├── downloadRemoteChanges() -> SyncResult
└── resolveConflicts(conflicts: [SyncConflict]) -> [SyncResolution]
```

#### 视图模型类

```
ScanViewModel
├── cameraService: CameraService
├── ocrService: OcrService
├── captureState: CaptureState
├── recognitionResult: RecognitionResult?
├── processedFood: Food?
├── isProcessing: Bool
├── startCapture()
├── captureImage()
├── processImage(image: UIImage)
├── confirmRecognitionResult()
└── saveFood()

FoodDetailViewModel
├── food: Food
├── analysisResult: NutritionAnalysis?
├── isLoading: Bool
├── isFavorite: Bool
├── loadAnalysis()
├── toggleFavorite()
├── shareFood()
├── deleteFood()
└── startComparison()

ComparisonViewModel
├── firstFood: Food?
├── secondFood: Food?
├── comparisonResult: ComparisonResult?
├── comparisonConfig: ComparisonConfig
├── isProcessing: Bool
├── selectFood(index: Int, food: Food)
├── updateConfig(config: ComparisonConfig)
├── performComparison()
├── saveComparison()
└── shareComparison()

ShareViewModel
├── food: Food
├── templates: [ShareTemplate]
├── selectedTemplate: ShareTemplate?
├── generatedImage: UIImage?
├── isLoading: Bool
├── loadTemplates()
├── selectTemplate(template: ShareTemplate)
├── customizeTemplate(customization: TemplateCustomization)
├── generateImage()
├── saveImage()
└── shareImage(platform: SocialPlatform)

UserProfileViewModel
├── user: User?
├── nutritionGoals: NutritionGoal?
├── isLoading: Bool
├── loadUserData()
├── updateUserInfo(userData: UserData)
├── updateNutritionGoals(goals: NutritionGoalData)
├── calculateRecommendedGoals()
└── saveChanges()

HistoryViewModel
├── foodRecords: [FoodRecord]
├── filterCriteria: FilterCriteria
├── isLoading: Bool
├── currentPage: Int
├── hasMorePages: Bool
├── loadHistory()
├── loadMoreRecords()
├── filterRecords(criteria: FilterCriteria)
├── searchRecords(query: String)
└── deleteRecord(recordId: String)
```

### 时序图 - 核心流程

#### 1. 食品扫描与识别流程

```
用户 -> ScanView: 点击扫描按钮
ScanView -> ScanViewModel: startCapture()
ScanViewModel -> CameraService: setupSession()
CameraService -> ScanViewModel: 相机准备就绪

用户 -> ScanView: 拍照
ScanView -> ScanViewModel: captureImage()
ScanViewModel -> CameraService: capturePhoto()
CameraService -> ScanViewModel: 返回图像数据

ScanViewModel -> ScanViewModel: processImage(image)
ScanViewModel -> OcrService: recognizeText(image)
OcrService -> OcrService: 图像预处理
OcrService -> Vision框架: 执行OCR识别
Vision框架 -> OcrService: 返回识别文本
OcrService -> ScanViewModel: 返回识别结果

ScanViewModel -> NutritionParser: parseNutritionData(text)
NutritionParser -> ScanViewModel: 返回结构化营养数据

ScanView -> 用户: 显示识别结果预览
用户 -> ScanView: 确认或修正结果
ScanView -> ScanViewModel: confirmRecognitionResult()

ScanViewModel -> 用户: 请求拍摄食品封面
用户 -> ScanViewModel: 拍摄或选择封面图片
ScanViewModel -> Food: 创建食品对象
ScanViewModel -> FoodRepository: saveFood(food)
FoodRepository -> CoreData: 保存数据
FoodRepository -> ScanViewModel: 保存成功

ScanViewModel -> ScanView: 更新UI显示成功保存
ScanView -> 用户: 跳转到食品详情页
```

#### 2. 食品PK对比流程

```
用户 -> ComparisonView: 进入对比页面
ComparisonView -> ComparisonViewModel: 初始化页面
ComparisonViewModel -> ComparisonView: 更新UI展示食品选择界面

用户 -> ComparisonView: 选择第一个食品
ComparisonView -> ComparisonViewModel: selectFood(index: 0, food)
ComparisonViewModel -> ComparisonView: 更新UI显示已选择食品1

用户 -> ComparisonView: 选择第二个食品
ComparisonView -> ComparisonViewModel: selectFood(index: 1, food)
ComparisonViewModel -> ComparisonView: 更新UI显示已选择食品2

用户 -> ComparisonView: 选择对比维度/模板
ComparisonView -> ComparisonViewModel: updateConfig(config)
ComparisonViewModel -> ComparisonView: 更新UI显示已选择维度

用户 -> ComparisonView: 执行对比
ComparisonView -> ComparisonViewModel: performComparison()
ComparisonViewModel -> ComparisonEngine: compare(first, second, config)
ComparisonEngine -> NutritionAnalyzer: 分析营养差异
NutritionAnalyzer -> ComparisonEngine: 返回分析结果
ComparisonEngine -> ComparisonViewModel: 返回对比结果

ComparisonViewModel -> ComparisonView: 更新UI展示对比结果
ComparisonView -> 用户: 显示图表和差异分析

用户 -> ComparisonView: 保存对比结果
ComparisonView -> ComparisonViewModel: saveComparison()
ComparisonViewModel -> FoodRepository: 保存对比记录
FoodRepository -> ComparisonViewModel: 保存成功确认

用户 -> ComparisonView: 分享对比结果
ComparisonView -> ShareViewModel: 初始化分享流程
```

#### 3. 分享图片生成流程

```
用户 -> FoodDetailView: 点击分享按钮
FoodDetailView -> ShareViewModel: 初始化(food)
ShareViewModel -> ShareImageGenerator: loadTemplates()
ShareImageGenerator -> 网络/本地: 加载模板数据
ShareImageGenerator -> ShareViewModel: 返回可用模板

ShareViewModel -> ShareView: 更新UI显示模板列表
用户 -> ShareView: 选择模板
ShareView -> ShareViewModel: selectTemplate(template)
ShareViewModel -> ShareImageGenerator: previewTemplate(template, food)
ShareImageGenerator -> ShareViewModel: 返回预览图像

ShareViewModel -> ShareView: 更新UI显示预览图像
用户 -> ShareView: 调整自定义选项
ShareView -> ShareViewModel: customizeTemplate(customization)
ShareViewModel -> ShareView: 更新UI显示自定义效果

用户 -> ShareView: 生成最终图片
ShareView -> ShareViewModel: generateImage()
ShareViewModel -> ShareImageGenerator: generateImage(template, data)
ShareImageGenerator -> CoreGraphics: 执行图像渲染
CoreGraphics -> ShareImageGenerator: 返回渲染图像
ShareImageGenerator -> ShareViewModel: 返回生成图像

ShareViewModel -> ShareView: 更新UI显示生成图像
用户 -> ShareView: 选择保存或分享
ShareView -> ShareViewModel: saveImage() 或 shareImage(platform)
ShareViewModel -> ShareImageGenerator: 保存或分享操作
ShareImageGenerator -> 系统API: 执行保存/分享
系统API -> 用户: 保存确认或分享界面弹出
```

## API文档

### 1. 用户认证与管理API

#### 1.1 用户注册

- **接口**：`POST /auth/register`
- **描述**：注册新用户账号
- **请求参数**：
  ```json
  {
    "email": "string",
    "password": "string",
    "name": "string",
    "gender": "male|female",
    "birthDate": "YYYY-MM-DD"
  }
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "userId": "string",
      "token": "string",
      "refreshToken": "string",
      "expiresIn": 3600
    }
  }
  ```

#### 1.2 用户登录

- **接口**：`POST /auth/login`
- **描述**：用户账号登录
- **请求参数**：
  ```json
  {
    "email": "string",
    "password": "string"
  }
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "userId": "string",
      "token": "string",
      "refreshToken": "string",
      "expiresIn": 3600
    }
  }
  ```

#### 1.3 刷新Token

- **接口**：`GET /auth/refresh`
- **描述**：刷新认证Token
- **请求头**：
  ```
  Authorization: Bearer {refreshToken}
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "token": "string",
      "refreshToken": "string",
      "expiresIn": 3600
    }
  }
  ```

#### 1.4 更新用户信息

- **接口**：`PUT /users/profile`
- **描述**：更新用户个人资料
- **请求头**：
  ```
  Authorization: Bearer {token}
  ```
- **请求参数**：
  ```json
  {
    "name": "string",
    "gender": "male|female",
    "birthDate": "YYYY-MM-DD",
    "height": 170.5,
    "weight": 65.0,
    "activityLevel": 1-4,
    "dietaryPreferences": ["vegetarian", "low-sugar"],
    "healthGoal": "weightLoss|muscleGain|maintenance"
  }
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "userId": "string",
      "updatedAt": "YYYY-MM-DDThh:mm:ssZ"
    }
  }
  ```

#### 1.5 获取用户信息

- **接口**：`GET /users/profile`
- **描述**：获取用户个人资料
- **请求头**：
  ```
  Authorization: Bearer {token}
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "userId": "string",
      "name": "string",
      "gender": "male|female",
      "birthDate": "YYYY-MM-DD",
      "height": 170.5,
      "weight": 65.0,
      "activityLevel": 2,
      "dietaryPreferences": ["vegetarian", "low-sugar"],
      "healthGoal": "weightLoss",
      "createdAt": "YYYY-MM-DDThh:mm:ssZ",
      "updatedAt": "YYYY-MM-DDThh:mm:ssZ"
    }
  }
  ```

### 2. 食品数据API

#### 2.1 获取食品列表

- **接口**：`GET /foods`
- **描述**：获取食品列表，支持分页和筛选
- **请求头**：
  ```
  Authorization: Bearer {token}
  ```
- **请求参数**：
  ```
  page: int (默认1)
  limit: int (默认20)
  category: string (可选)
  brand: string (可选)
  score: string (可选，格式A|B|C|D|E)
  sortBy: string (可选，name|brand|updatedAt|score)
  order: string (可选，asc|desc)
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "items": [
        {
          "foodId": "string",
          "name": "string",
          "brand": "string",
          "category": "string",
          "nutritionScore": "A-E",
          "imageUrl": "string",
          "updatedAt": "YYYY-MM-DDThh:mm:ssZ"
        }
      ],
      "total": 100,
      "page": 1,
      "limit": 20,
      "pages": 5
    }
  }
  ```

#### 2.2 获取食品详情

- **接口**：`GET /foods/{foodId}`
- **描述**：获取特定食品的详细信息
- **请求头**：
  ```
  Authorization: Bearer {token}
  ```
- **路径参数**：
  ```
  foodId: string
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "foodId": "string",
      "name": "string",
      "brand": "string",
      "category": "string",
      "barcode": "string",
      "imageUrl": "string",
      "nutritionScore": "A",
      "isUserCreated": false,
      "createdAt": "YYYY-MM-DDThh:mm:ssZ",
      "updatedAt": "YYYY-MM-DDThh:mm:ssZ",
      "nutritionData": {
        "calories": 65.0,
        "protein": 3.2,
        "fat": 3.6,
        "saturatedFat": 2.1,
        "transFat": 0.0,
        "carbohydrates": 4.8,
        "sugar": 4.8,
        "fiber": 0.0,
        "sodium": 40.0,
        "calcium": 120.0,
        "servingSize": 100.0,
        "servingUnit": "ml",
        "servingsPerContainer": 2.5,
        "lastVerified": "YYYY-MM-DDThh:mm:ssZ"
      },
      "ingredients": {
        "rawText": "string",
        "parsedIngredients": ["string"],
        "containsAllergens": ["string"]
      }
    }
  }
  ```

#### 2.3 提交新食品数据

- **接口**：`POST /foods`
- **描述**：提交新的食品数据
- **请求头**：
  ```
  Authorization: Bearer {token}
  Content-Type: multipart/form-data
  ```
- **请求参数**：
  ```
  name: string
  brand: string
  category: string
  barcode: string (可选)
  image: file (食品封面图片)
  nutritionData: json string (营养成分JSON数据)
  ingredients: json string (配料表JSON数据)
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "foodId": "string",
      "imageUrl": "string",
      "nutritionScore": "A-E"
    }
  }
  ```

#### 2.4 搜索食品

- **接口**：`GET /foods/search`
- **描述**：搜索食品
- **请求头**：
  ```
  Authorization: Bearer {token}
  ```
- **请求参数**：
  ```
  q: string (搜索关键词)
  type: string (可选，name|brand|barcode)
  limit: int (默认10)
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "items": [
        {
          "foodId": "string",
          "name": "string",
          "brand": "string",
          "category": "string",
          "imageUrl": "string",
          "nutritionScore": "A-E",
          "matchScore": 0.95
        }
      ],
      "total": 5
    }
  }
  ```

### 3. OCR识别API

#### 3.1 图像识别请求

- **接口**：`POST /ocr/scan`
- **描述**：提交图像进行OCR识别
- **请求头**：
  ```
  Authorization: Bearer {token}
  Content-Type: multipart/form-data
  ```
- **请求参数**：
  ```
  image: file (图像文件)
  detectAreas: boolean (是否自动检测区域)
  enhanceResult: boolean (是否增强识别结果)
  language: string (识别语言，zh-CN|en-US)
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "scanId": "string",
      "nutritionTable": {
        "detected": true,
        "boundingBox": [50, 100, 300, 400],
        "extractedData": {
          "calories": 65.0,
          "protein": 3.2,
          "fat": 3.6,
          "carbohydrates": 4.8,
          "sugar": 4.8,
          "sodium": 40.0,
          "confidence": 0.92
        }
      },
      "ingredientsList": {
        "detected": true,
        "boundingBox": [50, 500, 300, 600],
        "extractedText": "纯牛奶，维生素D",
        "confidence": 0.89
      },
      "suggestedFoods": [
        {
          "foodId": "string",
          "name": "string",
          "brand": "string",
          "confidence": 0.85
        }
      ],
      "meta": {
        "processingTime": 1.2
      }
    }
  }
```

#### 3.2 验证并增强OCR结果

- **接口**：`POST /ocr/verify`
- **描述**：验证并增强OCR识别结果
- **请求头**：
  ```
  Authorization: Bearer {token}
  ```
- **请求参数**：
  ```json
  {
    "scanId": "string",
    "userCorrections": {
      "nutritionTable": {
        "calories": 70.0,
        "protein": 3.5
      },
      "ingredientsList": "纯牛奶，维生素D，钙"
    }
  }
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "verifiedData": {
        "nutritionData": {
          "calories": 70.0,
          "protein": 3.5,
          "fat": 3.6,
          "carbohydrates": 4.8,
          "sugar": 4.8,
          "sodium": 40.0
        },
        "ingredients": {
          "rawText": "纯牛奶，维生素D，钙",
          "parsedIngredients": ["牛奶", "维生素D", "钙"],
          "containsAllergens": ["牛奶"]
        }
      },
      "confidence": 0.95
    }
  }
  ```

#### 3.3 提交OCR结果反馈

- **接口**：`POST /ocr/feedback`
- **描述**：提交OCR结果反馈以改进识别算法
- **请求头**：
  ```
  Authorization: Bearer {token}
  ```
- **请求参数**：
  ```json
  {
    "scanId": "string",
    "feedbackType": "correction|report|suggestion",
    "content": "string",
    "correctedData": {
      "nutritionTable": {},
      "ingredientsList": "string"
    }
  }
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "感谢您的反馈，我们将用它来改进我们的服务",
    "data": {
      "feedbackId": "string"
    }
  }
  ```

### 4. 分享模板API

#### 4.1 获取模板列表

- **接口**：`GET /templates`
- **描述**：获取可用的分享模板列表
- **请求头**：
  ```
  Authorization: Bearer {token}
  ```
- **请求参数**：
  ```
  category: string (可选，如'food'，'comparison'，'nutrition')
  seasonality: string (可选，如'allYear'，'spring'，'summer'，'autumn'，'winter')
  page: int (默认1)
  limit: int (默认20)
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "items": [
        {
          "templateId": "string",
          "name": "string",
          "category": "string",
          "previewImageUrl": "string",
          "seasonality": "allYear",
          "isDownloaded": false,
          "isFavorite": false,
          "lastUpdated": "YYYY-MM-DDThh:mm:ssZ"
        }
      ],
      "total": 100,
      "page": 1,
      "limit": 20,
      "pages": 5
    }
  }
  ```

#### 4.2 获取模板详情

- **接口**：`GET /templates/{templateId}`
- **描述**：获取特定模板的详细信息
- **请求头**：
  ```
  Authorization: Bearer {token}
  ```
- **路径参数**：
  ```
  templateId: string
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "templateId": "string",
      "name": "string",
      "category": "string",
      "previewImageUrl": "string",
      "downloadUrl": "string",
      "fileSize": 1024,
      "dimensions": {
        "width": 1080,
        "height": 1920
      },
      "supportedFields": [
        "food.name",
        "food.brand",
        "food.nutritionData.calories",
        "comparison.result"
      ],
      "customizableOptions": [
        {
          "name": "backgroundColor",
          "type": "color",
          "defaultValue": "#FFFFFF"
        },
        {
          "name": "showLogo",
          "type": "boolean",
          "defaultValue": true
        }
      ],
      "seasonality": "allYear",
      "isDownloaded": false,
      "isFavorite": false,
      "lastUpdated": "YYYY-MM-DDThh:mm:ssZ"
    }
  }
  ```

#### 4.3 获取推荐模板

- **接口**：`GET /templates/featured`
- **描述**：获取推荐模板列表
- **请求头**：
  ```
  Authorization: Bearer {token}
  ```
- **请求参数**：
  ```
  context: string (可选，如'food'，'comparison')
  limit: int (默认5)
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "items": [
        {
          "templateId": "string",
          "name": "string",
          "category": "string",
          "previewImageUrl": "string",
          "feature": "new|popular|seasonal"
        }
      ]
    }
  }
  ```

### 5. 数据同步API

#### 5.1 上传本地变更

- **接口**：`POST /sync/upload`
- **描述**：上传本地数据变更到服务器
- **请求头**：
  ```
  Authorization: Bearer {token}
  ```
- **请求参数**：
  ```json
  {
    "clientVersion": "string",
    "lastSyncTimestamp": "YYYY-MM-DDThh:mm:ssZ",
    "changes": [
      {
        "entity": "Food|FoodRecord|User|NutritionGoal",
        "action": "create|update|delete",
        "id": "string",
        "data": {},
        "timestamp": "YYYY-MM-DDThh:mm:ssZ"
      }
    ]
  }
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "syncId": "string",
      "accepted": [
        {
          "entity": "FoodRecord",
          "id": "string",
          "serverId": "string"
        }
      ],
      "rejected": [
        {
          "entity": "Food",
          "id": "string",
          "reason": "conflict|invalidData|permissionDenied"
        }
      ],
      "conflicts": [
        {
          "entity": "NutritionGoal",
          "id": "string",
          "localData": {},
          "serverData": {},
          "serverTimestamp": "YYYY-MM-DDThh:mm:ssZ"
        }
      ]
    }
  }
  ```

#### 5.2 下载服务器变更

- **接口**：`GET /sync/download`
- **描述**：从服务器下载数据变更
- **请求头**：
  ```
  Authorization: Bearer {token}
  ```
- **请求参数**：
  ```
  lastSyncTimestamp: YYYY-MM-DDThh:mm:ssZ
  entities: string (可选，逗号分隔的实体列表)
  limit: int (默认100)
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "syncId": "string",
      "currentTimestamp": "YYYY-MM-DDThh:mm:ssZ",
      "changes": [
        {
          "entity": "Food|FoodRecord|User|NutritionGoal",
          "action": "create|update|delete",
          "id": "string",
          "data": {},
          "timestamp": "YYYY-MM-DDThh:mm:ssZ"
        }
      ],
      "hasMore": false,
      "databaseVersion": "string"
    }
  }
  ```

#### 5.3 获取同步状态

- **接口**：`GET /sync/status`
- **描述**：获取当前同步状态
- **请求头**：
  ```
  Authorization: Bearer {token}
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "lastSuccessfulSync": "YYYY-MM-DDThh:mm:ssZ",
      "currentDatabaseVersion": "string",
      "pendingChanges": 0,
      "foodDatabaseLastUpdated": "YYYY-MM-DDThh:mm:ssZ",
      "templateDatabaseLastUpdated": "YYYY-MM-DDThh:mm:ssZ",
      "status": "upToDate|outOfDate|needsSync"
    }
  }
  ```

### 6. 食品对比API

#### 6.1 获取对比详情

- **接口**：`POST /foods/compare`
- **描述**：获取两种食品的详细对比结果
- **请求头**：
  ```
  Authorization: Bearer {token}
  ```
- **请求参数**：
  ```json
  {
    "firstFoodId": "string",
    "secondFoodId": "string",
    "comparisonType": "weightLoss|muscleGain|lowSugar|custom",
    "customDimensions": ["calories", "protein", "sugar"],
    "servingSize": {
      "firstFood": 100,
      "secondFood": 100
    }
  }
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "comparison": {
        "dimensions": [
          {
            "name": "calories",
            "label": "热量",
            "firstValue": 65.0,
            "secondValue": 95.0,
            "difference": -30.0,
            "percentageDifference": -31.6,
            "winner": "first",
            "importance": 0.9
          },
          {
            "name": "protein",
            "label": "蛋白质",
            "firstValue": 3.2,
            "secondValue": 2.5,
            "difference": 0.7,
            "percentageDifference": 28.0,
            "winner": "first",
            "importance": 0.8
          }
        ],
        "overallScore": {
          "firstFood": 8.5,
          "secondFood": 6.2
        },
        "recommendation": "根据减脂目标，建议选择第一种食品，它的热量更低且蛋白质含量更高。",
        "summary": "第一种食品在热量和蛋白质方面更有优势，总体更适合减脂目标。"
      },
      "firstFood": {
        "foodId": "string",
        "name": "string",
        "brand": "string",
        "imageUrl": "string",
        "nutritionScore": "A"
      },
      "secondFood": {
        "foodId": "string",
        "name": "string",
        "brand": "string",
        "imageUrl": "string",
        "nutritionScore": "C"
      }
    }
  }
  ```

#### 6.2 保存对比结果

- **接口**：`POST /foods/compare/save`
- **描述**：保存食品对比结果
- **请求头**：
  ```
  Authorization: Bearer {token}
  ```
- **请求参数**：
  ```json
  {
    "firstFoodId": "string",
    "secondFoodId": "string",
    "comparisonType": "weightLoss|muscleGain|lowSugar|custom",
    "customDimensions": ["calories", "protein", "sugar"],
    "resultSummary": "string"
  }
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "comparisonId": "string"
    }
  }
  ```

### 7. 食品记录API

#### 7.1 获取食品记录列表

- **接口**：`GET /records`
- **描述**：获取用户的食品扫描记录
- **请求头**：
  ```
  Authorization: Bearer {token}
  ```
- **请求参数**：
  ```
  startDate: YYYY-MM-DD (可选)
  endDate: YYYY-MM-DD (可选)
  favorite: boolean (可选)
  tags: string (可选，逗号分隔的标签)
  page: int (默认1)
  limit: int (默认20)
  sortBy: scanDate|name|nutritionScore (默认scanDate)
  order: asc|desc (默认desc)
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "items": [
        {
          "recordId": "string",
          "scanDate": "YYYY-MM-DDThh:mm:ssZ",
          "food": {
            "foodId": "string",
            "name": "string",
            "brand": "string",
            "imageUrl": "string",
            "nutritionScore": "A"
          },
          "favorite": true,
          "tags": ["早餐", "乳制品"]
        }
      ],
      "total": 100,
      "page": 1,
      "limit": 20,
      "pages": 5
    }
  }
  ```

#### 7.2 获取记录详情

- **接口**：`GET /records/{recordId}`
- **描述**：获取特定食品记录的详细信息
- **请求头**：
  ```
  Authorization: Bearer {token}
  ```
- **路径参数**：
  ```
  recordId: string
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "recordId": "string",
      "scanDate": "YYYY-MM-DDThh:mm:ssZ",
      "location": "string",
      "userNotes": "string",
      "consumptionAmount": 200.0,
      "favorite": true,
      "tags": ["早餐", "乳制品"],
      "food": {
        "foodId": "string",
        "name": "string",
        "brand": "string",
        "category": "string",
        "imageUrl": "string",
        "nutritionScore": "A",
        "nutritionData": {},
        "ingredients": {}
      },
      "comparisons": [
        {
          "comparisonId": "string",
          "comparisonDate": "YYYY-MM-DDThh:mm:ssZ",
          "secondFoodName": "string"
        }
      ]
    }
  }
  ```

#### 7.3 更新记录

- **接口**：`PUT /records/{recordId}`
- **描述**：更新食品记录信息
- **请求头**：
  ```
  Authorization: Bearer {token}
  ```
- **路径参数**：
  ```
  recordId: string
  ```
- **请求参数**：
  ```json
  {
    "userNotes": "string",
    "consumptionAmount": 200.0,
    "favorite": true,
    "tags": ["早餐", "乳制品"]
  }
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "recordId": "string",
      "updatedAt": "YYYY-MM-DDThh:mm:ssZ"
    }
  }
  ```

#### 7.4 删除记录

- **接口**：`DELETE /records/{recordId}`
- **描述**：删除特定食品记录
- **请求头**：
  ```
  Authorization: Bearer {token}
  ```
- **路径参数**：
  ```
  recordId: string
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "记录已成功删除",
    "data": null
  }
  ```

### 8. 营养目标API

#### 8.1 设置营养目标

- **接口**：`POST /users/nutrition-goals`
- **描述**：设置用户的营养目标
- **请求头**：
  ```
  Authorization: Bearer {token}
  ```
- **请求参数**：
  ```json
  {
    "caloriesGoal": 2000.0,
    "proteinGoal": 80.0,
    "fatGoal": 70.0,
    "carbsGoal": 250.0,
    "sugarLimit": 25.0,
    "sodiumLimit": 2300.0,
    "fiberGoal": 25.0,
    "isCustomized": true
  }
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "goalId": "string",
      "updatedAt": "YYYY-MM-DDThh:mm:ssZ"
    }
  }
  ```

#### 8.2 获取营养目标

- **接口**：`GET /users/nutrition-goals`
- **描述**：获取用户的营养目标
- **请求头**：
  ```
  Authorization: Bearer {token}
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "goalId": "string",
      "caloriesGoal": 2000.0,
      "proteinGoal": 80.0,
      "fatGoal": 70.0,
      "carbsGoal": 250.0,
      "sugarLimit": 25.0,
      "sodiumLimit": 2300.0,
      "fiberGoal": 25.0,
      "isCustomized": true,
      "createdAt": "YYYY-MM-DDThh:mm:ssZ",
      "updatedAt": "YYYY-MM-DDThh:mm:ssZ",
      "recommended": {
        "caloriesGoal": 1800.0,
        "proteinGoal": 72.0,
        "fatGoal": 60.0,
        "carbsGoal": 225.0,
        "sugarLimit": 22.5,
        "sodiumLimit": 2300.0,
        "fiberGoal": 25.0
      }
    }
  }
  ```

#### 8.3 计算推荐营养目标

- **接口**：`GET /users/nutrition-goals/recommended`
- **描述**：根据用户信息计算推荐的营养目标
- **请求头**：
  ```
  Authorization: Bearer {token}
  ```
- **请求参数**：
  ```
  healthGoal: weightLoss|muscleGain|maintenance (可选)
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "caloriesGoal": 1800.0,
      "proteinGoal": 72.0,
      "fatGoal": 60.0,
      "carbsGoal": 225.0,
      "sugarLimit": 22.5,
      "sodiumLimit": 2300.0,
      "fiberGoal": 25.0,
      "calculationSummary": "基于您的性别、年龄(30岁)、体重(65kg)、身高(170cm)、活动水平(轻度活动)和健康目标(减重)，我们推荐以上营养摄入目标。"
    }
  }
  ```

### 9. 大模型集成服务API

#### 9.1 多模态模型识别

- **接口**：`POST /ocr/multimodal-scan`
- **描述**：使用多模态大模型进行食品包装识别
- **请求头**：
  ```
  Authorization: Bearer {token}
  Content-Type: multipart/form-data
  ```
- **请求参数**：
  ```
  image: file (图像文件)
  enhanceResults: boolean (是否进行结果优化)
  modelProvider: string (可选，指定使用的模型供应商)
  extractNutrition: boolean (是否提取营养成分表)
  extractIngredients: boolean (是否提取配料表)
  language: string (识别语言，zh-CN|en-US)
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "scanId": "string",
      "recognitionResults": {
        "nutritionFacts": {
          "detected": true,
          "boundingBox": [50, 100, 300, 400],
          "structuredData": {
            "servingSize": {
              "value": 100,
              "unit": "g",
              "confidence": 0.95
            },
            "nutrients": [
              {
                "name": "能量",
                "value": 120,
                "unit": "kcal",
                "dailyValue": 6,
                "confidence": 0.98
              },
              {
                "name": "蛋白质",
                "value": 5.0,
                "unit": "g",
                "dailyValue": 8,
                "confidence": 0.97
              }
            ]
          },
          "rawText": "营养成分表(每100克)\n能量 120千卡(6%)\n蛋白质 5.0克(8%)"
        },
        "ingredientsList": {
          "detected": true,
          "boundingBox": [50, 450, 300, 500],
          "ingredients": [
            {
              "name": "小麦粉",
              "isMainIngredient": true,
              "confidence": 0.99
            },
            {
              "name": "白砂糖",
              "isMainIngredient": true,
              "confidence": 0.97
            }
          ],
          "allergens": ["小麦"],
          "rawText": "配料:小麦粉、白砂糖、鸡蛋、黄油、食用盐、香精。"
        },
        "productInfo": {
          "productName": {
            "text": "原味饼干",
            "confidence": 0.96
          },
          "brand": {
            "text": "好吃家",
            "confidence": 0.92
          },
          "netWeight": {
            "value": 200,
            "unit": "g",
            "confidence": 0.94
          }
        }
      },
      "modelProvider": "aliyun-tongyi",
      "modelVersion": "qianwen-vl-plus",
      "processingMetrics": {
        "processingTime": 1.4,
        "confidenceScore": 0.92
      }
    }
  }
  ```


### 3.3 核心服务模块
1. **用户服务（User Service）**
   // ... existing code ...

2. **食品数据服务（Food Database Service）**
   // ... existing code ...

3. **OCR增强服务（OCR Enhancement Service）**
   - 图像预处理优化
   - 多OCR引擎集成（百度OCR、腾讯OCR等）
   - 结果优化与矫正
   - 营养数据结构化提取
   - 识别准确率统计与改进
   - **多模态大模型集成**
     - 阿里通义千文API集成
     - 其他备选多模态模型（如百度文心一言）集成
     - 响应缓存和结果优化
     - 降级方案和失败处理
     - 提示词模板管理和版本控制
     - 图像预处理特化处理

4. **大模型服务（LLM Service）**
   - 多平台大模型API集成管理
   - 提示词工程模板库
   - 上下文优化与结果处理
   - 用户查询记忆与个性化
   - 健康建议内容安全过滤
   - 审核机制和合规性检查
   - 大模型响应缓存策略
   - 调用计量与成本控制
   - A/B测试基础设施

5. **模板资源服务（Template Resource Service）**
   // ... existing code ...

### 3.8 大模型集成服务规范

#### 3.8.1 多模态模型集成架构
- **模型服务商选择**：
  - 主要服务商：阿里通义千文
  - 备选服务商：百度文心一言、腾讯混元大模型
  - 灾备方案：OpenAI GPT-4V
  
- **服务集成模式**：
  - 模型服务抽象层：统一API接口规范
  - 动态路由分发：基于请求类型和服务健康状态
  - 结果合并机制：多模型结果整合优化
  - 中转代理封装：隐藏第三方接口细节

#### 3.8.2 OCR识别提示词策略
- **核心提示词结构**：
  ```
  角色：你是一位专业的食品包装营养成分及配料表分析专家，精通中文和英文食品包装标签的规范和格式。
  
  任务：从提供的食品包装图片中，准确识别并提取出：
  1. 营养成分表中的所有数值（每100克/毫升或每份）
  2. 配料表中的所有原材料
  3. 可能存在的过敏原警告
  
  要求：
  1. 以结构化JSON格式返回数据
  2. 数值必须包含单位（克/毫克/微克等）
  3. 对于不确定的内容，标记置信度
  4. 识别配料的顺序（按重量递减排列）
  5. 标注出可能的过敏原成分
  
  图片内容：[图片上下文描述]
  ```


#### 3.8.3 营养分析提示词策略
- **核心提示词结构**：
  ```
  角色：你是一位有营养学背景的专业营养师，熟悉《中国居民膳食指南》和DRIs营养素参考摄入量标准。
  
  背景：用户正在分析一份食品的营养成分，需要专业的分析和建议。
  
  用户信息：
  - 性别：[性别]
  - 年龄：[年龄]
  - 身高/体重：[身高]/[体重]
  - 活动水平：[活动水平]
  - 健康目标：[健康目标]
  - 特殊饮食限制：[特殊限制]
  
  食品营养数据：
  [结构化营养数据JSON]
  
  要求：
  1. 分析该食品的营养优缺点
  2. 评估该食品对用户健康目标的适配度
  3. 提供基于科学依据的食用建议（频率、搭配等）
  4. 指出需要注意的成分（如糖、钠、饱和脂肪等）
  5. 结合中国营养学会标准给出建议
  6. 如有特殊健康目标，提供针对性建议
  
  返回格式：结构化JSON，包含"优点"、"注意事项"、"建议"、"科学依据"四个部分
  ```



### 7. 营养分析API

#### 7.1 大模型营养分析

- **接口**：`POST /nutrition/analyze`
- **描述**：使用大模型分析食品营养数据并生成个性化建议
- **请求头**：
  ```
  Authorization: Bearer {token}
  ```
- **请求参数**：
  ```json
  {
    "foodId": "string",
    "userContext": {
      "healthGoal": "weightLoss|muscleGain|maintenance",
      "dietaryRestrictions": ["lowSodium", "diabetic", "glutenFree"],
      "specificConcerns": ["sugar", "cholesterol"]
    },
    "analysisLevel": "basic|detailed|comprehensive"
  }
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "analysisId": "string",
      "nutritionSummary": {
        "highlights": [
          {
            "type": "positive|negative|neutral",
            "nutrient": "protein|fat|sodium",
            "description": "蛋白质含量丰富，有助于肌肉修复"
          }
        ],
        "overallAssessment": "这是一种营养均衡的食品，尤其适合增肌期间食用。",
        "healthScore": 85
      },
      "dietaryRecommendations": {
        "frequencyAdvice": "建议每周食用3-4次",
        "portionAdvice": "每次建议食用100克",
        "timingAdvice": "最适合作为运动后的恢复餐食用",
        "complementaryFoods": ["全麦面包", "牛油果"]
      },
      "scientificBasis": {
        "references": [
          {
            "source": "《中国居民膳食指南(2022)》",
            "relevantPoints": ["每日蛋白质推荐摄入量"]
          }
        ],
        "nutritionPrinciples": ["蛋白质摄入与肌肉合成的关系", "碳水化合物与运动恢复"]
      },
      "healthGoalSpecific": {
        "goal": "muscleGain",
        "compatibility": 0.8,
        "specialAdvice": "作为增肌餐，可搭配复合碳水化合物食用，以优化蛋白质吸收。"
      }
    },
    "meta": {
      "generatedAt": "YYYY-MM-DDThh:mm:ssZ",
      "modelVersion": "string"
    }
  }
  ```

#### 7.2 食品配料深度分析

- **接口**：`POST /nutrition/ingredients-analysis`
- **描述**：深度分析食品配料成分及其健康影响
- **请求头**：
  ```
  Authorization: Bearer {token}
  ```
- **请求参数**：
  ```json
  {
    "foodId": "string",
    "ingredientText": "string", 
    "focusAreas": ["additives", "allergens", "nutritionValue", "processingLevel"]
  }
  ```
- **返回结果**：
  ```json
  {
    "status": 200,
    "message": "Success",
    "data": {
      "ingredients": [
        {
          "name": "白砂糖",
          "category": "sweetener",
          "nutritionImpact": "提供简单碳水化合物和热量，不含其他营养素",
          "healthConsiderations": "过量摄入可能增加肥胖和糖尿病风险",
          "naturalStatus": "refined",
          "alternatives": ["蜂蜜", "枣泥"]
        }
      ],
      "additives": [
        {
          "name": "柠檬酸",
          "function": "酸味剂",
          "safetyLevel": "safe",
          "regulatoryStatus": "合法食品添加剂，中国GB 2760允许使用",
          "healthConsiderations": "一般认为安全，少数人可能对其敏感"
        }
      ],
      "processingLevel": {
        "classification": "ultraProcessed",
        "explanation": "包含多种添加剂和高度加工成分",
        "healthImplications": "超加工食品长期大量摄入可能增加多种健康风险"
      },
      "allergenAlert": {
        "declaredAllergens": ["小麦", "大豆"],
        "possibleCrossContamination": ["坚果"],
        "hiddenSources": [
          {
            "ingredient": "植物油",
            "potentialAllergen": "大豆",
            "explanation": "如未标明来源，植物油可能来自大豆"
          }
        ]
      },
      "overallAssessment": "这是一种中度加工食品，包含部分添加剂。对普通消费者而言安全，但含有常见过敏原。建议具有小麦或大豆过敏史的消费者避免食用。"
    }
  }
  }


